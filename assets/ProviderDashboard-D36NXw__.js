import{r as x,j as e,s as d}from"./index-B3IZbtJy.js";function v(){const[h,c]=x.useState([]),[p,u]=x.useState(!0);x.useEffect(()=>{let s=null;async function o(){u(!0);const{data:a}=await d.auth.getUser(),t=a?.user?.id;if(!t){c([]),u(!1);return}const{data:n,error:g}=await d.from("bookings").select("*, service:service_id (title), user:user_id (email)").eq("provider_id",t).order("created_at",{ascending:!1});g&&console.error(g),c(n||[]),u(!1),s=d.channel(`provider-bookings-${t}`).on("postgres_changes",{event:"*",schema:"public",table:"bookings",filter:`provider_id=eq.${t}`},i=>{c(r=>{const f=r.find(l=>l.id===i.new.id);return i.eventType==="INSERT"?f?r:[i.new,...r]:i.eventType==="UPDATE"?r.map(l=>l.id===i.new.id?i.new:l):r})}).subscribe()}return o(),()=>{s&&d.removeChannel(s)}},[]);async function m(s,o){const{error:a}=await d.from("bookings").update({status:o}).eq("id",s);a?(console.error(a),alert("Update failed: "+a.message)):c(t=>t.map(n=>n.id===s?{...n,status:o}:n))}return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-indigo-50 p-6",children:e.jsxs("div",{className:"max-w-5xl mx-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6 text-gray-800",children:"Provider Dashboard"}),p?e.jsx("div",{className:"bg-white p-4 rounded shadow",children:"Loading..."}):h.length===0?e.jsx("div",{className:"bg-white p-4 rounded shadow text-gray-500",children:"No bookings yet."}):e.jsx("div",{className:"space-y-4",children:h.map(s=>e.jsxs("div",{className:"bg-white p-4 rounded shadow flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-lg",children:s.service?.title}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Customer: ",s.user?.email]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Scheduled:"," ",s.scheduled_date?new Date(s.scheduled_date).toLocaleString():"N/A"]}),e.jsxs("div",{className:"text-sm",children:["Status:"," ",e.jsx("span",{className:"font-medium capitalize",children:s.status})]})]}),e.jsxs("div",{className:"flex gap-2",children:[s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>m(s.id,"accepted"),className:"px-3 py-1 bg-green-600 text-white rounded",children:"Accept"}),e.jsx("button",{onClick:()=>m(s.id,"cancelled"),className:"px-3 py-1 bg-red-500 text-white rounded",children:"Reject"})]}),s.status==="accepted"&&e.jsx("button",{onClick:()=>m(s.id,"completed"),className:"px-3 py-1 bg-indigo-600 text-white rounded",children:"Mark Complete"})]})]},s.id))})]})})}export{v as default};
