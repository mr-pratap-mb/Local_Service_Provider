import{b as y,r as d,s as c,j as e}from"./index-2ZjFlii8.js";function N(){const{user:a,profile:l}=y(),[x,m]=d.useState([]),[h,p]=d.useState([]),[b,g]=d.useState(!0);d.useEffect(()=>{a&&(u(),v())},[a]);const u=async()=>{try{g(!0);const{data:s,error:r}=await c.from("services").select("*").eq("provider_id",a.id).order("created_at",{ascending:!1});if(r)throw r;p(s||[]);const{data:t,error:i}=await c.from("bookings").select("*, user:user_id(full_name, email), service:service_id(title)").eq("provider_id",a.id).order("created_at",{ascending:!1});if(i)throw i;m(t||[])}catch(s){console.error("Error fetching dashboard data:",s)}finally{g(!1)}},v=()=>{const s=c.channel(`provider_bookings:${a.id}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"bookings",filter:`provider_id=eq.${a.id}`},r=>{console.log("New booking received:",r),u()}).subscribe();return()=>s.unsubscribe()},o=async(s,r)=>{try{const{error:t}=await c.from("bookings").update({status:r}).eq("id",s).eq("provider_id",a.id);if(t){t.code==="23503"?alert("Cannot reject a booking that has already been accepted or completed."):(console.error("Error updating booking status:",t),alert(`Failed to update booking status: ${t.message}`));return}m(i=>i.map(n=>n.id===s?{...n,status:r}:n)),alert(`Booking ${r} successfully`)}catch(t){console.error("Unexpected error updating booking status:",t),alert("Failed to update booking status due to an unexpected error")}};return b?e.jsx("div",{className:"min-h-screen bg-gray-50 py-10 px-6 text-center",children:e.jsx("div",{className:"text-gray-600 text-lg",children:"Loading dashboard..."})}):!l||l.role!=="provider"?e.jsx("div",{className:"min-h-screen bg-gray-50 py-10 px-6 text-center",children:e.jsx("div",{className:"text-red-600 text-lg",children:"Access denied. Provider role required."})}):e.jsx("div",{className:"flex-1 bg-gray-50 mobile-padding",children:e.jsxs("div",{className:"responsive-container",children:[e.jsx("h2",{className:"responsive-text-2xl font-bold mb-4 md:mb-6 text-gray-800 mobile-text-center",children:"Provider Dashboard"}),e.jsxs("div",{className:"dashboard-grid",children:[e.jsxs("div",{className:"responsive-card bg-white rounded-lg shadow-md border border-gray-100",children:[e.jsx("h3",{className:"responsive-text-xl font-semibold mb-4 text-gray-700",children:"Your Services"}),h.length===0?e.jsx("div",{className:"text-gray-500 text-center py-4",children:"No services created yet."}):e.jsx("div",{className:"space-y-4",children:h.map(s=>e.jsxs("div",{className:"border-b border-gray-100 pb-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:s.title}),e.jsxs("p",{className:"text-sm text-gray-600",children:["â‚¹",s.price]})]},s.id))}),e.jsx("button",{onClick:()=>window.location.href="/addservice",className:"mt-4 w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 transition",children:"Add New Service"})]}),e.jsxs("div",{className:"responsive-card bg-white rounded-lg shadow-md border border-gray-100",children:[e.jsx("h3",{className:"responsive-text-xl font-semibold mb-4 text-gray-700",children:"Booking Requests"}),x.length===0?e.jsx("div",{className:"text-gray-500 text-center py-4",children:"No bookings yet."}):e.jsx("div",{className:"space-y-4",children:x.map(s=>e.jsxs("div",{className:"border-b border-gray-100 pb-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:s.service?.title||"Service"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["User: ",s.user?.full_name||s.user?.email||"N/A"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Date: ",new Date(s.scheduled_date).toLocaleString()]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Status: ",s.status]}),s.detailedAddress&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Detailed Address: ",s.detailedAddress]}),s.anyMessage&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Message: ",s.anyMessage]}),s.status==="pending"&&e.jsxs("div",{className:"mt-2 flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2",children:[e.jsx("button",{onClick:()=>o(s.id,"accepted"),className:"responsive-button bg-green-600 text-white rounded text-sm hover:bg-green-700 transition-colors",children:"Accept"}),e.jsx("button",{onClick:()=>o(s.id,"cancelled"),className:"responsive-button bg-red-600 text-white rounded text-sm hover:bg-red-700 transition-colors",children:"Reject"})]}),s.status==="accepted"&&e.jsx("button",{onClick:()=>o(s.id,"completed"),className:"responsive-button mt-2 bg-indigo-600 text-white rounded text-sm hover:bg-indigo-700 transition-colors",children:"Mark as Completed"})]},s.id))})]})]})]})})}export{N as default};
