import{r as s,u as Z,j as e,L as E,s as w}from"./index-BB-twZpJ.js";function D(){const[a,j]=s.useState(""),[f,N]=s.useState(""),[d,A]=s.useState(""),[u,h]=s.useState("user"),[m,P]=s.useState(""),[g,k]=s.useState(""),[x,t]=s.useState(!1),b=Z(),S=["yopmail.com","mailinator.com","tempmail.com","10minutemail.com","guerrillamail.com","dispostable.com","fakeinbox.com","trashmail.com","example.com"];async function C(r){if(r.preventDefault(),t(!0),!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(a)){alert("Please enter a valid email address."),t(!1);return}const z=a.split("@")[1];if(S.includes(z)){alert("Disposable email addresses are not allowed. Please use a permanent email address."),t(!1);return}if(!d.trim()){alert("Please enter your full name."),t(!1);return}if(!m.trim()){alert("Please enter your WhatsApp number."),t(!1);return}if(!g.trim()){alert("Please enter your location."),t(!1);return}try{const{data:n,error:y}=await w.auth.signUp({email:a,password:f});if(y)throw y;const c=n?.user;if(!c?.id)throw new Error("No user returned from signup");console.log("User created:",c.id),await new Promise(l=>setTimeout(l,3e3));let o=10,p=500,v=!1;for(;o>0&&!v;)try{console.log(`Attempting to update profile (attempt ${11-o}/10)`);const l={full_name:d,email:c.email||a,role:u,whatsapp_number:m,location:g};console.log("Updating profile with data:",l);const{error:i}=await w.from("profiles").update(l).eq("id",c.id);if(i)throw console.error("Profile update error:",i),i;console.log("Profile updated successfully with all fields"),v=!0}catch(l){if(o--,console.error(`Profile operation failed (${10-o}/10):`,l),o===0){console.warn("Profile update failed after all retries"),alert("Account created successfully! Please check your email for verification. You may need to complete your profile after logging in."),b("/login");return}await new Promise(i=>setTimeout(i,p)),p=Math.min(p*1.5,5e3)}alert("Signup successful! Please check your email for verification, then log in."),b("/login")}catch(n){console.error("Signup error:",n),alert("Signup failed: "+n.message)}finally{t(!1)}}return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-md overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-indigo-600 to-purple-700 p-8 text-white text-center",children:[e.jsx("h2",{className:"text-3xl font-bold mb-2",children:"Create an Account"}),e.jsx("p",{className:"text-indigo-100",children:"Join our community of service providers and users"})]}),e.jsxs("div",{className:"p-8",children:[e.jsxs("form",{onSubmit:C,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Full Name"}),e.jsx("input",{type:"text",value:d,onChange:r=>A(r.target.value),required:!0,className:"w-full border border-gray-200 rounded-lg p-4 focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"John Doe"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Email"}),e.jsx("input",{type:"email",value:a,onChange:r=>j(r.target.value),required:!0,className:"w-full border border-gray-200 rounded-lg p-4 focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"you@example.com",pattern:"[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$",title:"Please enter a valid email address"}),a&&!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/i.test(a)&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:"Please enter a valid email address"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Password"}),e.jsx("input",{type:"password",value:f,onChange:r=>N(r.target.value),required:!0,className:"w-full border border-gray-200 rounded-lg p-4 focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"••••••••"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"WhatsApp Number"}),e.jsx("input",{type:"tel",value:m,onChange:r=>P(r.target.value),required:!0,className:"w-full border border-gray-200 rounded-lg p-4 focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"+91 9876543210"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Location"}),e.jsx("input",{type:"text",value:g,onChange:r=>k(r.target.value),required:!0,className:"w-full border border-gray-200 rounded-lg p-4 focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"Enter your address"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Account Type"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("button",{type:"button",onClick:()=>h("user"),className:`py-3 rounded-lg font-medium transition ${u==="user"?"bg-indigo-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"I'm a User"}),e.jsx("button",{type:"button",onClick:()=>h("provider"),className:`py-3 rounded-lg font-medium transition ${u==="provider"?"bg-indigo-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"I'm a Provider"})]})]}),e.jsx("button",{type:"submit",disabled:x,className:"w-full bg-indigo-600 text-white py-4 rounded-lg font-bold hover:bg-indigo-700 transition disabled:opacity-70",children:x?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Creating Account..."]}):"Sign Up"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-gray-600",children:["Already have an account?"," ",e.jsx(E,{to:"/login",className:"text-indigo-600 font-medium hover:underline",children:"Log in"})]})})]})]})})}export{D as default};
