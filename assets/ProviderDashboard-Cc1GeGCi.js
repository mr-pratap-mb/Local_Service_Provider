import{b as v,r as i,s as c,j as e}from"./index-DufLLdDR.js";function j(){const{user:a,profile:n}=v(),[x,m]=i.useState([]),[g,p]=i.useState([]),[b,h]=i.useState(!0);i.useEffect(()=>{a&&(u(),y())},[a]);const u=async()=>{try{h(!0);const{data:s,error:r}=await c.from("services").select("*").eq("provider_id",a.id).order("created_at",{ascending:!1});if(r)throw r;p(s||[]);const{data:t,error:d}=await c.from("bookings").select("*, user:user_id(full_name, email), service:service_id(title)").eq("provider_id",a.id).order("created_at",{ascending:!1});if(d)throw d;m(t||[])}catch(s){console.error("Error fetching dashboard data:",s)}finally{h(!1)}},y=()=>{const s=c.channel(`provider_bookings:${a.id}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"bookings",filter:`provider_id=eq.${a.id}`},r=>{console.log("New booking received:",r),u()}).subscribe();return()=>s.unsubscribe()},o=async(s,r)=>{try{const{error:t}=await c.from("bookings").update({status:r}).eq("id",s).eq("provider_id",a.id);if(t){t.code==="23503"?alert("Cannot reject a booking that has already been accepted or completed."):(console.error("Error updating booking status:",t),alert(`Failed to update booking status: ${t.message}`));return}m(d=>d.map(l=>l.id===s?{...l,status:r}:l)),alert(`Booking ${r} successfully`)}catch(t){console.error("Unexpected error updating booking status:",t),alert("Failed to update booking status due to an unexpected error")}};return b?e.jsx("div",{className:"min-h-screen bg-gray-50 py-10 px-6 text-center",children:e.jsx("div",{className:"text-gray-600 text-lg",children:"Loading dashboard..."})}):!n||n.role!=="provider"?e.jsx("div",{className:"min-h-screen bg-gray-50 py-10 px-6 text-center",children:e.jsx("div",{className:"text-red-600 text-lg",children:"Access denied. Provider role required."})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-10 px-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("h2",{className:"text-3xl font-bold mb-8 text-gray-800",children:"Provider Dashboard"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md border border-gray-100",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4 text-gray-700",children:"Your Services"}),g.length===0?e.jsx("div",{className:"text-gray-500 text-center py-4",children:"No services created yet."}):e.jsx("div",{className:"space-y-4",children:g.map(s=>e.jsxs("div",{className:"border-b border-gray-100 pb-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:s.title}),e.jsxs("p",{className:"text-sm text-gray-600",children:["â‚¹",s.price]})]},s.id))}),e.jsx("button",{onClick:()=>window.location.href="/addservice",className:"mt-4 w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 transition",children:"Add New Service"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md border border-gray-100",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4 text-gray-700",children:"Booking Requests"}),x.length===0?e.jsx("div",{className:"text-gray-500 text-center py-4",children:"No bookings yet."}):e.jsx("div",{className:"space-y-4",children:x.map(s=>e.jsxs("div",{className:"border-b border-gray-100 pb-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:s.service?.title||"Service"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["User: ",s.user?.full_name||s.user?.email||"N/A"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Date: ",new Date(s.scheduled_date).toLocaleString()]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Status: ",s.status]}),s.detailedAddress&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Detailed Address: ",s.detailedAddress]}),s.anyMessage&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Message: ",s.anyMessage]}),s.status==="pending"&&e.jsxs("div",{className:"mt-2 flex space-x-2",children:[e.jsx("button",{onClick:()=>o(s.id,"accepted"),className:"bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700",children:"Accept"}),e.jsx("button",{onClick:()=>o(s.id,"cancelled"),className:"bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700",children:"Reject"})]}),s.status==="accepted"&&e.jsx("button",{onClick:()=>o(s.id,"completed"),className:"mt-2 bg-indigo-600 text-white px-3 py-1 rounded text-sm hover:bg-indigo-700",children:"Mark as Completed"})]},s.id))})]})]})]})})}export{j as default};
