import{a as S,u as D,b as L,r as o,j as e,s as n}from"./index-C721HQLq.js";function B(){const{id:g}=S(),p=D(),{user:d}=L(),[s,l]=o.useState(null),[j,f]=o.useState(!0),[c,w]=o.useState(""),[v,N]=o.useState(""),[b,k]=o.useState(""),[u,y]=o.useState(!1),[x,a]=o.useState("");o.useEffect(()=>{async function t(){try{f(!0);const{data:r,error:i}=await n.from("services").select("id, title, description, price, provider_id, category_id, location").eq("id",g).single();if(i)console.error("Error fetching service:",i),a(`Failed to load service: ${i.message}`),l(null);else if(!r)a("Service not found. It may have been removed or does not exist."),l(null);else{const{data:h,error:m}=await n.from("profiles").select("id, full_name").eq("id",r.provider_id).single();m?(console.error("Error fetching provider:",m),l({...r,provider:{full_name:"Professional Provider"}})):l({...r,provider:h}),a("")}}catch(r){console.error("Unexpected error fetching service:",r),a(`Unexpected error: ${r.message}`),l(null)}finally{f(!1)}}t()},[g]);const _=async t=>{if(t.preventDefault(),!d){p("/login");return}if(!c){a("Please select a date and time for your booking.");return}try{y(!0),a("");const{data:r,error:i}=await n.from("bookings").insert([{user_id:d.id,provider_id:s.provider_id,service_id:g,scheduled_date:c,status:"pending",category_id:s.category_id,detailedaddress:v||"",anymessage:b||""}]).select();if(i)throw i;if(r&&r.length>0){const h=r[0],{error:m}=await n.from("notifications").insert([{recipient_id:s.provider_id,title:"Booking Request",content:`${d.full_name||"A user"} has requested a booking for ${s.title||"your service"} scheduled on ${c?new Date(c).toLocaleString():"N/A"}. New Booking Request ID: ${h.id}`,type:"new_booking",is_read:!1}]);m&&console.error("Error sending notification to provider:",m)}await n.channel(`user_bookings:${d.id}`).send({type:"broadcast",event:"refresh_bookings",payload:{user_id:d.id}}),await n.channel(`bookings:provider:${s.provider_id}`).send({type:"broadcast",event:"refresh_bookings",payload:{provider_id:s.provider_id}}),localStorage.setItem("refreshUserDashboard",Date.now().toString()),alert("Booking successful! You will be notified when the provider responds."),setTimeout(()=>{p("/user-dashboard")},500)}catch(r){console.error("Booking error:",r),a("Failed to create booking: "+r.message)}finally{y(!1)}};return j?e.jsx("div",{className:"p-10 text-center text-purple-700",children:"Loading service..."}):s?e.jsx("div",{className:"min-h-screen bg-gray-50 py-10 px-6",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-8 p-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:"h-80 bg-gray-100 rounded-xl overflow-hidden mb-6",children:e.jsx("div",{className:"bg-gray-200 border-2 border-dashed rounded-xl w-full h-full flex items-center justify-center",children:e.jsx("span",{className:"text-gray-500 font-medium",children:"Service Image"})})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:s.title}),e.jsx("p",{className:"text-gray-700 mb-6",children:s.description}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-indigo-600 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{className:"text-xl font-bold text-indigo-600",children:["â‚¹",s.price]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-indigo-600 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),e.jsx("span",{className:"text-gray-600",children:s.location||"Multiple locations"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-indigo-600 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),e.jsx("span",{className:"text-gray-600",children:s.provider?.full_name||"Professional Provider"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-6 border border-gray-200",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-6",children:"Book this Service"}),x&&e.jsx("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded-lg text-sm",children:x}),e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"scheduledDate",className:"block text-gray-700 font-medium mb-2",children:"Select Date and Time"}),e.jsx("input",{type:"datetime-local",id:"scheduledDate",value:c,onChange:t=>w(t.target.value),className:"w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-indigo-500 focus:border-transparent",min:new Date().toISOString().slice(0,16),required:!0})]}),e.jsxs("div",{className:"p-3 bg-white rounded-lg border border-gray-200",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-800 mb-3 flex items-center",children:[e.jsx("span",{className:"mr-2",children:"ðŸ“"}),"Additional Information (Optional)"]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"detailedAddress",className:"block text-sm text-gray-700 font-medium mb-1 flex items-center",children:[e.jsx("span",{className:"mr-1",children:"ðŸ“"}),"Detailed Address",e.jsx("span",{className:"ml-2 text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full",children:"Optional"})]}),e.jsx("input",{type:"text",id:"detailedAddress",value:v,onChange:t=>N(t.target.value),className:"w-full border border-gray-300 rounded-lg p-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Flat no., building name, landmark..."})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"anyMessage",className:"block text-sm text-gray-700 font-medium mb-1 flex items-center",children:[e.jsx("span",{className:"mr-1",children:"ðŸ’¬"}),"Message to Provider",e.jsx("span",{className:"ml-2 text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full",children:"Optional"})]}),e.jsx("textarea",{id:"anyMessage",value:b,onChange:t=>k(t.target.value),className:"w-full border border-gray-300 rounded-lg p-2 text-sm focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Special instructions or requirements...",rows:"2"})]})]}),e.jsx("button",{type:"submit",disabled:u,className:`w-full py-3 rounded-lg font-medium transition ${u?"bg-indigo-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700 text-white"}`,children:u?"Booking...":"Book Now"})]})]})]})})})}):e.jsx("div",{className:"p-10 text-center text-gray-600",children:x||"Service not found."})}export{B as default};
