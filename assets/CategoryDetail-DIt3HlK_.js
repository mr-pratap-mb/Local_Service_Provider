import{a as j,r as x,s as t,j as e,L as v}from"./index-BB-twZpJ.js";function _(){const{id:a}=j(),[d,p]=x.useState(null),[g,n]=x.useState([]),[u,h]=x.useState(!0);x.useEffect(()=>(w(),b(),()=>{t.channel(`services-${a}`).unsubscribe()}),[a]);async function w(){try{h(!0);const{data:r,error:s}=await t.from("categories").select("id, name").eq("id",a).single();if(s)throw s;p(r);const{data:i,error:o}=await t.from("services").select(`
          id,
          title,
          description,
          price,
          provider_id
        `).eq("category_id",a).order("created_at",{ascending:!1});if(o)throw o;if(i&&i.length>0){const l=i.map(f=>f.provider_id),{data:c}=await t.from("profiles").select("id, full_name").in("id",l),m=i.map(f=>({...f,profiles:c?.find(y=>y.id===f.provider_id)||{full_name:"Professional Provider"}}));n(m)}else n(i||[])}catch(r){console.error("Error fetching:",r.message)}finally{h(!1)}}function b(){t.channel(`services-${a}`).on("postgres_changes",{event:"*",schema:"public",table:"services",filter:`category_id=eq.${a}`},async r=>{if(r.eventType==="INSERT")try{const{data:s,error:i}=await t.from("services").select("id, title, description, price, provider_id").eq("id",r.new.id).single();if(!i&&s){const{data:o}=await t.from("profiles").select("id, full_name").eq("id",s.provider_id).single(),l={...s,profiles:o||{full_name:"Professional Provider"}};n(c=>[l,...c])}}catch(s){console.error("Error fetching new service:",s)}else if(r.eventType==="UPDATE")try{const{data:s,error:i}=await t.from("services").select("id, title, description, price, provider_id").eq("id",r.new.id).single();if(!i&&s){const{data:o}=await t.from("profiles").select("id, full_name").eq("id",s.provider_id).single(),l={...s,profiles:o||{full_name:"Professional Provider"}};n(c=>c.map(m=>m.id===r.new.id?l:m))}}catch(s){console.error("Error fetching updated service:",s)}else r.eventType==="DELETE"&&n(s=>s.filter(i=>i.id!==r.old.id))}).subscribe()}return u?e.jsx("div",{className:"p-10 text-center text-purple-700",children:"Loading..."}):d?e.jsx("div",{className:"min-h-screen bg-white py-10 px-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsxs("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-2",children:[d.name," Services"]}),e.jsxs("p",{className:"text-gray-600 max-w-2xl mx-auto",children:["Browse and book professional ",d.name.toLowerCase()," services near you"]})]}),g.length===0?e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-12 text-center",children:[e.jsx("div",{className:"text-2xl text-gray-500 mb-4",children:"No services available yet"}),e.jsxs("p",{className:"text-gray-600 mb-6 max-w-lg mx-auto",children:["Be the first to offer ",d.name.toLowerCase()," services in your area"]}),e.jsx(v,{to:"/add-service",className:"inline-block bg-indigo-600 text-white py-3 px-8 rounded-lg font-medium hover:bg-indigo-700 transition",children:"List Your Service"})]}):e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8",children:g.map(r=>e.jsxs("div",{className:"bg-white rounded-xl shadow-md overflow-hidden border border-gray-100 hover:shadow-lg transition-all duration-300",children:[e.jsx("div",{className:"h-48 bg-gray-100 overflow-hidden relative",children:e.jsx("div",{className:"bg-gray-200 border-2 border-dashed rounded-xl w-full h-full flex items-center justify-center",children:e.jsx("span",{className:"text-gray-500 font-medium",children:"Service Image"})})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:r.title}),e.jsxs("span",{className:"text-xl font-bold text-indigo-600",children:["â‚¹",r.price]})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-2",children:r.description}),e.jsxs("div",{className:"flex items-center text-gray-500 text-sm mb-4",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),r.profiles?.full_name||"Professional Provider"]}),e.jsx(v,{to:`/services/${r.id}`,className:"block w-full text-center bg-indigo-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-indigo-700 transition",children:"View Details"})]})]},r.id))})]})}):e.jsx("div",{className:"p-10 text-center text-gray-600",children:"Category not found."})}export{_ as default};
